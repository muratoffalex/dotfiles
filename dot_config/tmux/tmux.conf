# GENERAL SETTINGS
set -g prefix C-a # Main prefix
set -g base-index 1 # Starting index for new window
set -g pane-base-index 1 # Starting index for new pane
set -g mouse on # Enable mouse
set -g status-keys vi # Copy-paste vi mode for command prompt
setw -g mode-keys vi # Copy-paste vi mode
set -g set-clipboard on # use system clipboard
set -g history-limit 50000 # History limit, default 2000
set -g display-time 1500 # Time for which status line messages and indicators are displayed in miliseconds, 0 means diplay until a key is pressed
set -g default-terminal "screen-256color" # 256 color
set -sa terminal-features ",*256col*:RGB" # True color support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' # underscore colours
setw -g aggressive-resize on # Resize panes on window size change
set -sg escape-time 0 # Time in milliseconds for which tmux waits for escape sequences
set-option -g detach-on-destroy off # Prevent tmux from closing when last pane is closed

# For zen-mode.nvim plugin
set-option -g allow-passthrough on # Allow programs in the pane to bypass tmux

# TODO: automatic rename not working with continuum and resurrect, empty string is displayed
# setw -g automatic-rename on                            # Automatic window renaming
# setw -g automatic-rename-format '#{pane_current_path}' # Format of automatic window renaming
# setw -g allow-rename off
# set-hook -g after-new-session 'rename-window _'
# set-hook -g after-new-window  'rename-window _'
# set-option -g set-titles off
# set-option -g set-titles-string "#T"
# setw -g automatic-rename-format '#{?#{==:#{pane_current_command},fish},#{b:pane_current_path},#{pane_current_command}}' # Format of automatic window renaming

# KEY BINDINGS
bind s choose-tree -sZ -O name # Choose tree with sort by name

unbind %
bind | split-window -h 

unbind '"'
bind - split-window -v

unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded"

unbind ,
bind , command-prompt "rename-window '%%'"

bind -r -T prefix       M-Up              resize-pane -U 5
bind -r -T prefix       M-Down            resize-pane -D 5
bind -r -T prefix       M-Left            resize-pane -L 5
bind -r -T prefix       M-Right           resize-pane -R 5

bind -T copy-mode-vi 'v' send -X begin-selection 
bind -T copy-mode-vi 'y' send -X copy-selection 

unbind C-b # Remove the old prefix
bind C-a send-prefix # Send Ctrl+a to applications by pressing it twice

# APPEARANCE
set -g status-position top
set -g status-style 'bg=default' # transparent
set -g status-interval 5 # update status every 30 seconds
set -g status-justify left
set -g status-left "#[fg=blue,bold,bg=default] 󰄛 #S     "
set -g status-right "#[fg=#b4befe,bold,bg=default]%a %Y-%m-%d 󱑒 %H:%M:%S %p #(curl "wttr.in/?format=1") #{online_status}"
set -g status-left-length 200    # increase length (from 10)
set -g status-right-length 200    # increase length (from 10)
# orange or color171 or magenta
# set-window-option -g window-status-current-format '#[fg=white,bold]** #{window_index} #[fg=green]#{pane_current_command} #[fg=blue]#(echo "#{pane_current_path}" | rev | cut -d'/' -f-3 | rev) #[fg=white]**|'
# set-window-option -g window-status-format '#[fg=white,bold]#{window_index} #[fg=green]#{pane_current_command} #[fg=blue]#(echo "#{pane_current_path}" | rev | cut -d'/' -f-3 | rev) #[fg=white]|'
setw -g window-status-current-format '#[fg=color171,bg=default](#I #W#{?window_zoomed_flag, ,})'
setw -g window-status-format '#[fg=gray,bg=default](#I) #W'
setw -g window-status-last-style 'fg=white,bg=default'
setw -g window-status-separator '#[fg=blue,bold,bg=default]  '

set -g message-command-style 'bg=default,fg=yellow'
set -g message-style 'bg=default,fg=yellow'
setw -g mode-style 'bg=default,fg=yellow'
setw -g pane-active-border-style 'fg=magenta,bg=default'
setw -g pane-border-style 'fg=brightblack,bg=default'

# tmux statusbar in 2 lines, second line for padding and prompt
set -g status 2 # statusbar in 2 lines
set -g 'status-format[1]' '' # second line empty

# List of plugins
set -g @plugin 'tmux-plugins/tpm'			# packet manager
# set -g @plugin 'tmux-plugins/tmux-sensible'		# standard tmux community options
set -g @plugin 'tmux-plugins/tmux-resurrect'		# restore tmux environment after system restart 
set -g @plugin 'tmux-plugins/tmux-continuum'		# save and restore tmux sessions
set -g @plugin 'tmux-plugins/tmux-sessionist'		# manipulating sessions with keybindings
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'	# nerd font for window name
set -g @plugin 'tmux-plugins/tmux-online-status'        # internet connection status

# Plugins settings
set -g @resurrect-capture-pane-contents 'on' # auto save and restore pane content
# set -g @resurrect-strategy-nvim 'session' # restore nvim sessions too
set -g @continuum-restore 'on' # enable continuum plugin
set -g @online_icon "#[fg=green,bg=default] "
set -g @offline_icon "#[fg=red,bg=default] "

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.tmux/plugins/tpm/tpm"
